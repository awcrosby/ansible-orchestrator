---

- name: run the main role
  become: true
  become_method: sudo
  become_user: root
  hosts: all
  pre_tasks:
    - name: install latest ca-certificates
      package: name=ca-certificates state=latest
    - name: install curl
      package: name=curl
    - name: install percona mysql repo
      shell: curl -O https://repo.percona.com/apt/percona-release_0.1-4.$(lsb_release -sc)_all.deb && dpkg -i percona-release_0.1-4.$(lsb_release -sc)_all.deb
      args:
        creates: /etc/apt/sources.list.d/percona-release.list
        executable: /bin/bash
        chdir: /tmp
    - name: refresh apt cache
      apt:
        update_cache: yes
  roles:
    - role: entercloudsuite.mysql
      mysql_packages:
        - percona-server-server-5.7
      mysql_users:
        - name: orchestrator
          host: '127.0.0.1'
          password: orchestrator
          priv: '*.*:ALL'
    - role: ansible-orchestrator
      orchestrator_mysql_user: orchestrator
      orchestrator_mysql_password: orchestrator
